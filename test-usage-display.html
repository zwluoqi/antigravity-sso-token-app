<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usage Data Display Test</title>
    <link rel="stylesheet" href="src/renderer/styles.css">
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <h1>Usage Data Display Test</h1>
        </header>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- çŠ¶æ€å¡ç‰‡ -->
            <div class="status-cards">
                <div class="card status-card">
                    <div class="card-header">
                        <h3>å½“å‰TokençŠ¶æ€</h3>
                        <span id="tokenStatus" class="status-badge status-active">æœ‰æ•ˆ</span>
                    </div>
                    <div class="card-body">
                        <div class="status-info">
                            <div class="info-item">
                                <label>Token ID:</label>
                                <span id="currentTokenId">test-token-123</span>
                            </div>
                            <div class="info-item">
                                <label>è¿‡æœŸæ—¶é—´:</label>
                                <span id="tokenExpiry">2025-08-18 12:38:08</span>
                            </div>
                            <div class="info-item">
                                <label>æœ€åæ›´æ–°:</label>
                                <span id="lastUpdate">2025-08-17 12:38:08</span>
                            </div>
                        </div>
                        <!-- Usage Data Section -->
                        <div class="usage-data-section" id="usageDataSection">
                            <div class="usage-title">ä½¿ç”¨é‡ç»Ÿè®¡</div>
                            <div id="usageDataContainer" class="usage-data-container">
                                <!-- Test usage data will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æµ‹è¯•æŒ‰é’® -->
            <div class="action-section">
                <div class="card">
                    <div class="card-header">
                        <h3>æµ‹è¯•æ“ä½œ</h3>
                    </div>
                    <div class="card-body">
                        <div class="action-buttons">
                            <button id="testUsageBtn" class="btn btn-success">
                                <span class="icon">ğŸ“Š</span>
                                æ˜¾ç¤ºæµ‹è¯•ä½¿ç”¨é‡æ•°æ®
                            </button>
                            <button id="clearUsageBtn" class="btn btn-secondary">
                                <span class="icon">ğŸ—‘ï¸</span>
                                æ¸…é™¤ä½¿ç”¨é‡æ•°æ®
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ç®€åŒ–çš„å·¥å…·å‡½æ•°
        const utils = {
            formatDate(date) {
                if (!date) return '-';
                const d = new Date(date);
                if (isNaN(d.getTime())) return '-';
                return d.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            }
        };

        // ç®€åŒ–çš„åº”ç”¨çŠ¶æ€ç®¡ç†
        class TestAppState {
            constructor() {
                this.usageData = null;
            }

            setUsageData(usageData) {
                this.usageData = usageData;
                this.updateUsageDisplay();
            }

            updateUsageDisplay() {
                const usageDataSection = document.getElementById('usageDataSection');
                const usageDataContainer = document.getElementById('usageDataContainer');
                
                if (this.usageData && Array.isArray(this.usageData) && this.usageData.length > 0) {
                    // Show the usage data section
                    usageDataSection.style.display = 'block';
                    
                    // Clear existing content
                    usageDataContainer.innerHTML = '';
                    
                    // Create usage items for each resource type
                    this.usageData.forEach(usage => {
                        const usageItem = this.createUsageItem(usage);
                        usageDataContainer.appendChild(usageItem);
                    });
                } else {
                    // Hide the usage data section if no data
                    usageDataSection.style.display = 'none';
                }
            }

            createUsageItem(usage) {
                const { resourceType, currentUsage, limit } = usage;
                const percentage = limit > 0 ? Math.round((currentUsage / limit) * 100) : 0;
                
                // Determine the status class based on usage percentage
                let statusClass = '';
                if (percentage >= 90) {
                    statusClass = 'usage-danger';
                } else if (percentage >= 70) {
                    statusClass = 'usage-warning';
                }
                
                const usageItem = document.createElement('div');
                usageItem.className = `usage-item ${statusClass}`;
                
                // Create resource type label
                const usageType = document.createElement('div');
                usageType.className = 'usage-type';
                usageType.textContent = this.getResourceTypeLabel(resourceType);
                
                // Create usage stats container
                const usageStats = document.createElement('div');
                usageStats.className = 'usage-stats';
                
                // Create usage numbers
                const usageNumbers = document.createElement('div');
                usageNumbers.className = 'usage-numbers';
                usageNumbers.textContent = `${currentUsage}/${limit}`;
                
                // Create progress bar
                const usageProgress = document.createElement('div');
                usageProgress.className = 'usage-progress';
                
                const progressBar = document.createElement('div');
                progressBar.className = `usage-progress-bar ${statusClass}`;
                progressBar.style.width = `${Math.min(percentage, 100)}%`;
                
                usageProgress.appendChild(progressBar);
                
                // Create percentage display
                const usagePercentage = document.createElement('div');
                usagePercentage.className = 'usage-percentage';
                usagePercentage.textContent = `${percentage}%`;
                
                // Assemble the usage stats
                usageStats.appendChild(usageNumbers);
                usageStats.appendChild(usageProgress);
                usageStats.appendChild(usagePercentage);
                
                // Assemble the usage item
                usageItem.appendChild(usageType);
                usageItem.appendChild(usageStats);
                
                return usageItem;
            }

            getResourceTypeLabel(resourceType) {
                const labels = {
                    'SPEC': 'SPEC',
                    'VIBE': 'VIBE',
                    'AGENTIC_REQUEST': 'æ™ºèƒ½è¯·æ±‚'
                };
                return labels[resourceType] || resourceType;
            }
        }

        // åˆå§‹åŒ–æµ‹è¯•åº”ç”¨
        const testApp = new TestAppState();

        // æµ‹è¯•æ•°æ®
        const testUsageData = [
            {
                resourceType: 'SPEC',
                currentUsage: 25,
                limit: 100
            },
            {
                resourceType: 'VIBE',
                currentUsage: 75,
                limit: 100
            },
            {
                resourceType: 'AGENTIC_REQUEST',
                currentUsage: 95,
                limit: 100
            }
        ];

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('testUsageBtn').addEventListener('click', () => {
            testApp.setUsageData(testUsageData);
            console.log('æ˜¾ç¤ºæµ‹è¯•ä½¿ç”¨é‡æ•°æ®:', testUsageData);
        });

        document.getElementById('clearUsageBtn').addEventListener('click', () => {
            testApp.setUsageData(null);
            console.log('æ¸…é™¤ä½¿ç”¨é‡æ•°æ®');
        });

        // åˆå§‹åŒ–æ—¶éšè—ä½¿ç”¨é‡æ•°æ®
        document.getElementById('usageDataSection').style.display = 'none';
    </script>
</body>
</html>